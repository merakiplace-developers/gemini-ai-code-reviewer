name: Gemini AI Code Reviewer

on:
  workflow_call:
    inputs:
      EXCLUDE:
        required: false
        type: string
    secrets:
      VERTEXAI_CREDENTIALS_JSON:
        required: true
      VERTEXAI_PROJECT_ID:
        required: true

jobs:
  gemini-code-review:
    runs-on: ubuntu-latest
    if: |
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '/gemini-review')
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run Gemini AI Code Reviewer
        env:
          VERTEXAI_CREDENTIALS_JSON: ${{ secrets.VERTEXAI_CREDENTIALS_JSON }}
          VERTEXAI_PROJECT_ID: ${{ secrets.VERTEXAI_PROJECT_ID }}
        run: |
          python3.10 review_code_gemini.py